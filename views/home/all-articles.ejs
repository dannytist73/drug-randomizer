<div class="container mx-auto px-4 py-8">
  <!-- Page Header -->
  <div class="mb-10">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-3xl font-bold text-blue-900">All Articles</h1>
      <a
        href="/resources"
        class="text-blue-600 hover:text-blue-800 inline-flex items-center"
      >
        <svg
          class="w-5 h-5 mr-1"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M10 19l-7-7m0 0l7-7m-7 7h18"
          ></path>
        </svg>
        Back to Resources
      </a>
    </div>
    <p class="text-lg text-gray-600 max-w-3xl">
      Explore our comprehensive library of articles about drug awareness,
      prevention, treatment, and support. Find the information you need to make
      informed decisions and help others.
    </p>
  </div>

  <!-- Filter Options -->
  <div class="mb-8">
    <div class="bg-white rounded-lg shadow-sm p-4 flex flex-wrap gap-4">
      <div>
        <label
          for="categoryFilter"
          class="block text-sm font-medium text-gray-700 mb-1"
          >Category</label
        >
        <select
          id="categoryFilter"
          class="w-40 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option value="">All Categories</option>
          <option value="Prevention">Prevention</option>
          <option value="Recovery">Recovery</option>
          <option value="Policy">Policy</option>
          <option value="Workplace">Workplace</option>
          <option value="Education">Education</option>
          <option value="Treatment">Treatment</option>
        </select>
      </div>

      <div>
        <label for="sortBy" class="block text-sm font-medium text-gray-700 mb-1"
          >Sort By</label
        >
        <select
          id="sortBy"
          class="w-40 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option value="date-desc">Newest First</option>
          <option value="date-asc">Oldest First</option>
          <option value="title">Title A-Z</option>
          <option value="readTime">Reading Time</option>
        </select>
      </div>

      <div class="flex-grow">
        <label
          for="searchArticles"
          class="block text-sm font-medium text-gray-700 mb-1"
          >Search</label
        >
        <input
          type="text"
          id="searchArticles"
          placeholder="Search articles..."
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>
    </div>
  </div>

  <!-- Articles Grid -->
  <div
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-10"
    id="articlesContainer"
  >
    <% articles.forEach(article => { %>
    <div
      class="article-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition"
      data-category="<%= article.category %>"
      data-title="<%= article.title %>"
      data-date="<%= new Date(article.date).toISOString() %>"
      data-readtime="<%= article.readTime %>"
    >
      <div
        class="h-48 bg-cover bg-center"
        style="background-image: url('<%= article.imageUrl %>')"
      ></div>
      <div class="p-6">
        <div class="flex justify-between items-center mb-2">
          <span
            class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium"
            ><%= article.category %></span
          >
          <span class="text-sm text-gray-500"
            ><%= article.readTime %> min read</span
          >
        </div>
        <h3 class="text-lg font-bold mb-2 text-blue-900">
          <%= article.title %>
        </h3>
        <p class="text-gray-600 text-sm mb-2"><%= article.date %></p>
        <p class="text-gray-700 mb-4 line-clamp-3"><%= article.excerpt %></p>
        <a
          href="/resources/<%= article.slug %>"
          class="text-blue-600 hover:text-blue-800 font-medium inline-flex items-center"
        >
          Continue Reading
          <svg
            class="w-4 h-4 ml-1"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M14 5l7 7m0 0l-7 7m7-7H3"
            ></path>
          </svg>
        </a>
      </div>
    </div>
    <% }); %>
  </div>

  <!-- No Results Message -->
  <div id="noResults" class="hidden text-center py-10">
    <svg
      class="w-16 h-16 text-gray-400 mx-auto mb-4"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
      ></path>
    </svg>
    <h3 class="text-lg font-medium text-gray-900 mb-2">No articles found</h3>
    <p class="text-gray-600">Try adjusting your filters or search terms.</p>
  </div>

  <!-- Pagination -->
  <div class="flex justify-center mt-8">
    <nav class="flex items-center">
      <a
        href="#"
        class="px-3 py-1 rounded-md mr-1 text-gray-600 hover:bg-gray-100"
        >&laquo;</a
      >
      <a href="#" class="px-3 py-1 rounded-md mr-1 bg-blue-600 text-white">1</a>
      <a
        href="#"
        class="px-3 py-1 rounded-md mr-1 text-gray-600 hover:bg-gray-100"
        >2</a
      >
      <a
        href="#"
        class="px-3 py-1 rounded-md mr-1 text-gray-600 hover:bg-gray-100"
        >3</a
      >
      <span class="px-3 py-1 text-gray-600">...</span>
      <a
        href="#"
        class="px-3 py-1 rounded-md mr-1 text-gray-600 hover:bg-gray-100"
        >&raquo;</a
      >
    </nav>
  </div>

  <!-- Subscribe CTA -->
  <div class="mt-16 bg-blue-50 rounded-lg p-8 text-center">
    <h2 class="text-2xl font-bold text-blue-900 mb-4">
      Stay Updated with New Resources
    </h2>
    <p class="text-gray-700 max-w-2xl mx-auto mb-6">
      Subscribe to our newsletter to receive new articles, resources, and
      updates about drug prevention and awareness directly to your inbox.
    </p>
    <div class="max-w-md mx-auto">
      <form
        action="#"
        method="POST"
        class="flex flex-wrap md:flex-nowrap gap-2"
      >
        <input
          type="email"
          placeholder="Your email address"
          class="flex-grow px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        />
        <button
          type="submit"
          class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md transition"
        >
          Subscribe
        </button>
      </form>
    </div>
  </div>
</div>

<!-- Filtering and Sorting Script -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const articleCards = document.querySelectorAll(".article-card");
    const noResultsDiv = document.getElementById("noResults");
    const categoryFilter = document.getElementById("categoryFilter");
    const sortBySelect = document.getElementById("sortBy");
    const searchInput = document.getElementById("searchArticles");

    // Apply filters and sort
    function applyFilters() {
      const categoryValue = categoryFilter.value;
      const sortValue = sortBySelect.value;
      const searchValue = searchInput.value.toLowerCase();

      let visibleCount = 0;

      // Filter articles
      articleCards.forEach((card) => {
        const category = card.dataset.category;
        const title = card.dataset.title.toLowerCase();
        const excerpt = card
          .querySelector("p.line-clamp-3")
          .textContent.toLowerCase();

        const categoryMatch = !categoryValue || category === categoryValue;
        const searchMatch =
          !searchValue ||
          title.includes(searchValue) ||
          excerpt.includes(searchValue);

        if (categoryMatch && searchMatch) {
          card.classList.remove("hidden");
          visibleCount++;
        } else {
          card.classList.add("hidden");
        }
      });

      // Show/hide no results message
      if (visibleCount === 0) {
        noResultsDiv.classList.remove("hidden");
      } else {
        noResultsDiv.classList.add("hidden");
      }

      // Sort visible articles
      const container = document.getElementById("articlesContainer");
      const visibleCards = Array.from(articleCards).filter(
        (card) => !card.classList.contains("hidden")
      );

      visibleCards.sort((a, b) => {
        if (sortValue === "date-desc") {
          return new Date(b.dataset.date) - new Date(a.dataset.date);
        } else if (sortValue === "date-asc") {
          return new Date(a.dataset.date) - new Date(b.dataset.date);
        } else if (sortValue === "title") {
          return a.dataset.title.localeCompare(b.dataset.title);
        } else if (sortValue === "readTime") {
          return parseInt(a.dataset.readtime) - parseInt(b.dataset.readtime);
        }
        return 0;
      });

      // Reorder DOM
      visibleCards.forEach((card) => {
        container.appendChild(card);
      });
    }

    // Add event listeners
    categoryFilter.addEventListener("change", applyFilters);
    sortBySelect.addEventListener("change", applyFilters);
    searchInput.addEventListener("input", applyFilters);

    // Initial sort
    applyFilters();
  });
</script>
